<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:my="http://java.sun.com/jsf/composite/recursos"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ps="http://xmlns.jcp.org/jsf/passthrough">

    <f:event listener="#{LoginBean.accessoMedico()}" type="preRenderView" /> #{personasBean.cargarPersona()}

    <h:head>
        <title>American College</title>
        <link rel="shortcut icon" type="image/x-icon" href="#{request.contextPath}/img/favicon.ico" />
        <link rel="stylesheet" type="text/css" href="#{request.contextPath}/css/main.css" />
    </h:head>






    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.71/pdfmake.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.71/vfs_fonts.js"></script>








    <b:scrollUp distance="200" animation="fade" text="" name="scrollUpCustom" />

    <b:modal id="modalRol" title="Rol de usuario" style="font-weight: bold;" closable="true" close-on-escape="true" backdrop="true" rendered="#{loginBean.renderizarSiNoEsEstudiante()}">
        <b:panel span="14">
            <b:form>
                <b:selectOneMenu value="#{loginBean.cambioRol}">
                    <f:selectItem itemLabel="Seleccionar el rol de usuario con el que desea trabajar" itemValue="" noSelectionOption="true" />
                    <f:selectItems value="#{loginBean.recuperarRoles()}" var="r" itemLabel="#{r}" itemValue="#{r}" />
                </b:selectOneMenu>
                <b:panel span="4" offset="5">
                    <b:row>
                        <b:commandButton value="Cambiar Rol" action="#{loginBean.cambiarRol()}" look="primary" />
                    </b:row>
                </b:panel>
            </b:form>
        </b:panel>
    </b:modal>

    <my:cabecera id="cabecera"/>
    <my:menuLateralMedico id="menuLateralMedico"/>












    <h:body>

        <b:modal id="modalEdicionSignos" title="Edición de signos vitales" closable="true"
                 close-on-escape="true" backdrop="true" size="modal-lg">
            <b:form id="formEdicionSignos" >

                <b:panel title="Signos vitales" look="info" collapsible="false" id="panelSignos">

                    <b:row>
                        <b:column span="4">
                            <b:inputText label="Presion Arterial Sistólica"
                                         placeholder="P.S."
                                         id="sig_presion_sistolica"
                                         maxlength="100"
                                         value="#{HistoriaBean.signos.sigPresionSistolica}"
                                         required="true"
                                         requiredMessage="Ingrese la presión sistólica"/>
                        </b:column>
                        <b:column span="4">
                            <b:inputText label="Presion Arterial Diastólica"
                                         placeholder="P.D."
                                         id="sig_presion_diastolica"
                                         maxlength="100"
                                         value="#{HistoriaBean.signos.sigPresionDiastolica}"
                                         required="true"
                                         requiredMessage="Ingrese la presión diastólica"/>
                        </b:column>
                        <b:column span="4">
                            <b:inputText label="Presion Arterial Media"
                                         placeholder="P.A.M."
                                         id="sig_presion_arterial_media"
                                         maxlength="100"
                                         value="#{HistoriaBean.signos.sigPresionArterialMedia}"
                                         required="true"
                                         requiredMessage="Ingrese la presión arterial media"/>
                        </b:column>
                    </b:row>
                    <b:row>
                        <b:column span="4">
                            <b:inputText label="Frecuencia Respiratoria"
                                         placeholder="F.R."
                                         id="sig_frecuencia_respiratoria"
                                         maxlength="100"
                                         value="#{HistoriaBean.signos.sigFrecuenciaRespiratoria}"
                                         required="true"
                                         requiredMessage="Ingrese la frecuencia respiratoria"/>
                        </b:column>
                        <b:column span="4">
                            <b:inputText label="Frecuencia Respiratoria"
                                         placeholder="F.R."
                                         id="sig_frecuencia_cardiaca"
                                         maxlength="100"
                                         value="#{HistoriaBean.signos.sigSaturacion}"
                                         required="true"
                                         requiredMessage="Ingrese la saturaciòn"/>
                        </b:column>
                    </b:row>

                </b:panel>
                <b:panel title="Datos Antropométricos" look="info" collapsible="false">
                    <b:row>
                        <b:column span="2">
                            <b:inputText label="Peso"
                                         placeholder="Peso"
                                         id="sig_peso"
                                         size="13"
                                         maxlength="100"
                                         value="#{HistoriaBean.signos.sigPeso}"
                                         required="true"
                                         requiredMessage="Ingrese el peso"/>
                        </b:column>
                        <b:column span="2">
                            <b:inputText label="Estatura"
                                         placeholder="Estatura"
                                         id="sig_pestatura"
                                         size="13"
                                         maxlength="100"
                                         value="#{HistoriaBean.signos.sigEstatura}"
                                         required="true"
                                         requiredMessage="Ingrese la estatura"/>
                        </b:column>
                        <b:column span="3">
                            <b:inputText label="Indice de masa corporal"
                                         placeholder="I.M.C."
                                         id="sig_imc"
                                         size="13"
                                         maxlength="100"
                                         value="#{HistoriaBean.signos.sigImc}"
                                         required="true"
                                         requiredMessage="Ingrese la indice de masa corporal"/>
                        </b:column>
                        <b:column span="3">
                            <b:inputText label="Perímetro abdominal"
                                         placeholder="Perímetro Abdominal"
                                         id="sig_perimetro_abdominal"
                                         size="13"
                                         maxlength="100"
                                         value="#{HistoriaBean.signos.sigPerimetroAbdominal}"
                                         required="true"
                                         requiredMessage="Ingrese el perímetro abdominal"/>
                        </b:column>
                    </b:row>
                </b:panel>
                <b:panel title="Mediciones Capilares" look="info" collapsible="false">
                    <b:row>
                        <b:column span="3">
                            <b:inputText label="Glucosa Capilar"
                                         placeholder="Glucosa Capilar"
                                         id="sig_glucosa_capilar"
                                         size="13"
                                         maxlength="100"
                                         value="#{HistoriaBean.signos.sigGlucosaCapilar}"
                                         required="false"
                                         requiredMessage="Ingrese la glucosa capilar"/>
                        </b:column>
                        <b:column span="3">
                            <b:inputText label="Valor Hemoglobina"
                                         placeholder="Valor Hemoglobina"
                                         id="sig_valor_hemoglobina"
                                         size="13"
                                         maxlength="100"
                                         value="#{HistoriaBean.signos.sigValorHemoglobina}"
                                         required="false"
                                         requiredMessage="Ingrese el valor de la hemoglobina"/>
                        </b:column>
                        <b:column span="4">
                            <b:inputText label="Valor Hemoglobina Corregido"
                                         placeholder="Valor Hemoglobina Corregido"
                                         id="sig_valor_hemoglobina_corredigo"
                                         size="13"
                                         maxlength="100"
                                         value="#{HistoriaBean.signos.sigValorHemoglobinaCorr}"
                                         required="false"
                                         requiredMessage="Ingrese el valor de la hemoglobina corregido"/>
                        </b:column>
                    </b:row>
                    <b:row contentDisabled="false">

                        <b:column span="4" offset="4">
                            <b:commandButton large-screen="full-width" id="submit"
                                             value="Actualizar Signos"
                                             oncomplete="$('#modalEdicionSignos').modal('hide')"
                                             action="#{HistoriaBean.actualizarSignosHistoria()}"
                                             look="primary" ajax="true" update="@form :growl"/>
                        </b:column>

                    </b:row>

                    <p:separator/>

                </b:panel>

            </b:form>
        </b:modal>

        <b:modal id="modalEdicionHistoria" title="Edición de enfermedad" closable="true"
                 close-on-escape="true" backdrop="true" size="modal-lg">
            <b:form id="formEdicionHistoria" >

                <b:panel title="Historia clínica" look="info" collapsible="false" id="panelHistoria">

                    <b:row>
                        <b:column span="4">
                            <b:inputText label="Motivo Consulta"
                                         placeholder="Motivo Consulta"
                                         id="sig_presion_sistolica"
                                         maxlength="100"
                                         value="#{HistoriaBean.historia.hisMotivo}"
                                         required="true"
                                         requiredMessage="Ingrese el motivo de la consulta"/>
                        </b:column>
                        <b:column span="4">
                            <b:inputText value="#{HistoriaBean.nombre_enfermedad}"
                                                 label="Enfermedad"
                                                 placeholder="Digite el nombre de una patología"
                                                 typeahead="true"
                                                 id="nomEnfermedadActual"
                                                 typeahead-limit="20"
                                                 typeahead-values="#{EnfermedadBean.listarEnfermedades()}">
                                <f:ajax event="change" listener="#{EnfermedadBean.listarEnfermedadListener()}" render="" />
                                <f:ajax render="commentform :growl" />
                            </b:inputText>
                        </b:column>
                    </b:row>
                    <b:row contentDisabled="false">

                        <b:column span="4" offset="4">
                            <b:commandButton large-screen="full-width" id="submit"
                                             value="Actualizar Historia"
                                             oncomplete="$('#modalEdicionHistoria').modal('hide')"
                                             action="#{HistoriaBean.actualizarHistoria()}"
                                             look="primary" ajax="true" update="@form :growl"/>
                        </b:column>

                    </b:row>
                </b:panel>

            </b:form>
        </b:modal>

        <p:idleMonitor timeout="600000">
            <p:ajax event="idle" listener="#{loginBean.sesionInactiva()}" />
        </p:idleMonitor>


        <b:growl id="growl" escape="true" />

        <b:container fluid="true">
            <b:panel span="10" offset="0">


                <b:form id="commentform">
                    #{HistoriaBean.inicializarHistorias()}
                    #{HistoriaBean.recuperarHistoriasDia()}
                    <h3 id="reply-title">
                        <b>Historial de citas del día</b>
                    </h3>
                    <!-- ******************************************************************************************************************************************* -->
                    <br/>
                    <b:container id="container" fluid="true" contentDisabled="false">

                        <b:dataTable large-screen="full-width" id="inscritosTabla"
                                     value="#{HistoriaBean.historiasdia}" var="historia"
                                     responsive="true" style="font-size: 11px"
                                     info="true" content-disabled="false"
                                     excel="true" csv="true" pdf="true" print="true"
                                     paginated="true" searching="true"
                                     page-length="25" multi-column-search="true"
                                     multi-column-search-position="top" >
                            <b:dataTableColumn label="Codigo" value="#{historia.hisId}" style="width: 10%" />
                            <b:dataTableColumn label="Nombres" value="#{historia.personas.perNombres}" style="width: 30%" order="asc"/>
                            <b:dataTableColumn label="Apellidos" value="#{historia.personas.perApellidos}" style="width: 30%"/>
                            <b:dataTableColumn label="Fecha" value="#{historia.hisFechaCreacion}" style="width: 20%" />
<!--                            <b:dataTableColumn label="Signos" style="width: 10%" >
                                <b:row>
                                    <b:column span="1" offset="0">
                                        <b:commandButton ajax="true"
                                                         update=":modalEdicionSignos:formEdicionSignos :growl"
                                                         action="# {HistoriaBean.recuperarSignosId(historia.signos.sigId)}"
                                                         oncomplete="$('#modalEdicionSignos').modal('show')"
                                                         tooltip="Editar Historia" look="warning">
                                            <b:iconAwesome name="pencil"></b:iconAwesome>
                                        </b:commandButton>
                                    </b:column>
                                </b:row>
                            </b:dataTableColumn>
                            <b:dataTableColumn label="Enfermedad" style="width: 10%" >
                                <b:row>
                                    <b:column span="1" offset="0">
                                        <b:commandButton ajax="true"
                                                         update=":modalEdicionHistoria:formEdicionHistoria :growl"
                                                         action="# {HistoriaBean.recuperarHistoriaID(historia.hisId)}"
                                                         oncomplete="$('#modalEdicionHistoria').modal('show')"
                                                         tooltip="Editar Enfermedad" look="warning">
                                            <b:iconAwesome name="pencil"></b:iconAwesome>
                                        </b:commandButton>
                                    </b:column>
                                </b:row>
                            </b:dataTableColumn>-->
                            <b:dataTableColumn label="Cita" style="width: 5%" >
                                <b:row>
                                    <b:column span="1" offset="0">
                                        <b:commandButton ajax="true"
                                                         update=":modalEdicionHistoria:formEdicionHistoria :growl"
                                                         action="#{HistoriaBean.VerCitaMedica(historia.hisId)}"
                                                         oncomplete="$('#modalEdicionHistoria').modal('show')"
                                                         tooltip="Revisar cita" look="success">
                                            <b:iconAwesome name="eye"></b:iconAwesome>
                                        </b:commandButton>
                                    </b:column>
                                </b:row>
                            </b:dataTableColumn>
                        </b:dataTable>

                        <!-- ******************************************************************************************************************************************* -->

                    </b:container>

                </b:form>
            </b:panel>
        </b:container>
        <br/><br/><br/><br/>
    </h:body>

</html>