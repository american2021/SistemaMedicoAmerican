<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:my="http://java.sun.com/jsf/composite/recursos"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    
    <f:event listener="#{LoginBean.comprobarLogin}" type="preRenderView" />

    <h:head>
        <title>Departamento Médico</title>
        <link rel="shortcut icon" type="image/x-icon" href="#{request.contextPath}/img/favicon.ico" />
        <link rel="stylesheet" type="text/css" href="#{request.contextPath}/css/main.css" />
    </h:head>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.71/pdfmake.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.71/vfs_fonts.js"></script>

    <script>
        $.blockUI.defaults.css = {
            padding: 0,
            margin: 0,
            width: '30%',
            top: '40%',
            left: '35%',
            textAlign: 'center',
            color: '#000',
            border: '0px solid #aaa',
            backgroundColor: 'transparent',
            cursor: 'wait'
        };
        $.blockUI.defaults.overlayCSS.backgroundColor = '#b4bab4'; //5E655E b4bab4 eac99a ff0000
        $.blockUI.defaults.overlayCSS.opacity = 0.5;
        $.blockUI.defaults.message = '<b:spinner name="refresh" size="4x" style-class="spiner"/>';
    </script>
    
    <script>
        // Function to show the specified panel and hide others
        function showPanel(panelId) {
            console.log(panelId);
            // Hide all panels
            $('[id^="panel"]').hide();
            // Show the selected panel
            $('#' + panelId).show();
        }
        
        function toggleHistorialPanel() {
            var diagnosticoPanel = document.getElementById('formExamenLabIma:listadoExamenPaciente');
            var historialPanel = document.getElementById('formExamenLabIma:historialPanel');
            var historyExamen = document.getElementById('formExamenLabIma:historyExamen');
            // Verifica si el panel de historial está visible
            var historialVisible = historialPanel.style.display === 'block';
            // Oculta o muestra el panel de historial
            historialPanel.style.display = historialVisible ? 'none' : 'block';
            // Oculta o muestra el panel de exámenes dependiendo del estado del panel de historial
            diagnosticoPanel.style.display = historialVisible ? 'block' : 'none';
            // Cambiar nombre al boton
            historyExamen.innerHTML = historialVisible ? '&nbsp;Mostrar Historial' : '&nbsp;Mostrar Exámenes';
        }
        
        function toggleHistorialAntecedentePanel() {
            var diagnosticoPanel = document.getElementById('formAntecedente:panelListaAntecedente');
            var historialPanel = document.getElementById('formAntecedente:panelListaHistoriaAntecedente');
            var historyAntecedente = document.getElementById('formAntecedente:historyAntecedente');
            // Verifica si el panel de historial está visible
            var historialVisible = historialPanel.style.display === 'block';
            // Oculta o muestra el panel de historial
            historialPanel.style.display = historialVisible ? 'none' : 'block';
            // Oculta o muestra el panel de exámenes dependiendo del estado del panel de historial
            diagnosticoPanel.style.display = historialVisible ? 'block' : 'none';
            // Cambiar nombre al boton
            historyAntecedente.innerHTML = historialVisible ? '&nbsp;Mostrar Historial' : '&nbsp;Mostrar Antecedente';
        }
        
        function toggleHistorialDiagnosticoPanel() {
            var diagnosticoPanel = document.getElementById('formDiagnostico:listadoDiagnosticoPaciente');
            console.log(diagnosticoPanel);
            var historialPanel = document.getElementById('formDiagnostico:historialDiagnosticoPanel');
            var historyDiagnostico = document.getElementById('formDiagnostico:historyDiagnostico');
            // Verifica si el panel de historial está visible
            var historialVisible = historialPanel.style.display === 'block';
            // Oculta o muestra el panel de historial
            historialPanel.style.display = historialVisible ? 'none' : 'block';
            // Oculta o muestra el panel de exámenes dependiendo del estado del panel de historial
            diagnosticoPanel.style.display = historialVisible ? 'block' : 'none';
            // Cambiar nombre al boton
            historyDiagnostico.innerHTML = historialVisible ? '&nbsp;Mostrar Historial' : '&nbsp;Mostrar Diagnóstico';
        }
        
        function confirmarEliminacionTratamiento(descripcion, nombre, indicaciones) {
            var mensaje = '¿Está seguro de que desea eliminar el tratamiento ' + descripcion + ', con el medicamento ' + nombre + ', además las indicaciones ' + indicaciones + ' ?';
            // Confirmar y retornar el resultado
            return confirm(mensaje);
        }
        
        function confirmarEliminacionAntecedente(nombre, descripcion) {
            var mensaje = '¿Está seguro de que desea eliminar el antecedente ' + nombre + ', con la descripción ' + descripcion + ' ?';
            // Confirmar y retornar el resultado
            return confirm(mensaje);
        }
        
        function confirmarEliminacionDiagnostico(descripcion, observacion) {
            var mensaje = '¿Está seguro de que desea eliminar el diagnóstico ' + descripcion +  ', con la observación ' + observacion +' ?';
            // Confirmar y retornar el resultado
            return confirm(mensaje);
        }
        function confirmarEliminacionExamen(exaGrupo, resultado) {
            var mensaje = '¿Está seguro de que desea eliminar el exámen ' + exaGrupo +  ', con resultado ' + resultado +' ?';
            // Confirmar y retornar el resultado
            return confirm(mensaje);
        }
    </script>

    <b:scrollUp distance="200" animation="fade" text="" name="scrollUpCustom" />
    
    <my:cabecera id="cabecera"/>
<!--    <my:menuLateralMedico id="menuLateralMedico"/>
    <my:menuLateralEstudiante id="menuLateralEstudiante"/>-->
    <!--<my:menuLateralAdministrador id="menuLateralAdministrador"/>-->
    <my:menuHorizontalAdministrador id="menuHorizontalAdministrador"/>
    <!--<my:menuLateralContador id="menuLateralContador"/>-->
 
    <h:body onload="toggleHistorialPanel()">
        <b:modal id="modalActualizarHistoriaExamen" title="Actualizar exámen" closable="true"
                 close-on-escape="true" backdrop="true" size="modal-lg">
            <ui:include src="citaMedica/modalActualizarExamen.xhtml" />
        </b:modal>
        <b:modal id="modaUpdateHistoriaTratamiento" title="Actualizar tratamiento" closable="true"
                 close-on-escape="true" backdrop="true" size="modal-lg">
            <ui:include src="citaMedica/modalActualizarTratamiento.xhtml" />
        </b:modal>
        
        <b:modal id="modaUpdateHistoriaDiagnostico" title="Actualizar diagnóstico" closable="true"
                 close-on-escape="true" backdrop="true" size="modal-lg">
            <ui:include src="citaMedica/modalActualizarDiagnostico.xhtml" />
        </b:modal>
        <b:modal id="modalAddDiagnostico" title="Crear diagnóstico" closable="true"
                 close-on-escape="true" backdrop="true" size="modal-lg">
            <ui:include src="citaMedica/modalCrearDiagnostico.xhtml" />
        </b:modal>
        <b:modal id="modalUpdateAntecedente" title="Actualizar antecedente" closable="true"
                 close-on-escape="true" backdrop="true" size="modal-lg">
            <ui:include src="citaMedica/modalActualizarAntecedente.xhtml" />
        </b:modal>
        

            
        <style>
            #modalDeleteHistoriaTratamiento .modal-header {
                text-align: center;
            }
            #modalDeleteHistoriaTratamiento .modal-title {
                margin: 0 auto;
            }
            .custom-button{
                margin-top: 6px;
                color: #333333;
                -webkit-transition: all 0.2s ease-in-out;
                -o-transition: all 0.2s ease-in-out;
                transition: all 0.2s ease-in-out;
                background: #ffffff;
                line-height: 1.428571429;
                border: 1px solid transparent;
                  border-top-color: transparent;
                  border-right-color: transparent;
                  border-bottom-color: transparent;
                  border-left-color: transparent;
                border-radius: 4px 4px 0 0;
                width: 100%;
                border-color: #e7e7e7;
                
                position: relative;
                display: block;
                padding: 10px 15px;
                
            }
            .custom-button:hover{
                padding-bottom: 15px;
                margin-top: 0;
                background: #ffffff;
            }
        </style>
        
        <p:idleMonitor timeout="600000">
            <p:ajax event="idle" listener="#{LoginBean.sesionInactiva()}" />
        </p:idleMonitor>
       

        <b:growl id="growl" escape="true" />
        
        <script>
            
            window.onload = function() {
                // Ocultar paneles aquí
                showPanel('panel1');
                document.getElementById('formExamenLabIma:historialPanel').style.display = 'none';
                document.getElementById('formExamenLabIma:listadoExamenPaciente').style.display = 'block';
                document.getElementById('formDiagnostico:listadoDiagnosticoPaciente').style.display = 'block';;
                document.getElementById('formDiagnostico:historialDiagnosticoPanel').style.display = 'none';;
                document.getElementById('formAntecedente:panelListaAntecedente').style.display = 'block';
                document.getElementById('formAntecedente:panelListaHistoriaAntecedente').style.display = 'none';
            }
        </script>

        <b:container fluid="true">
           
            <div class="vertical-tabview">
                <b:row>
                    <b:form>
                        <b:column span="2">
                            <b:row>
                                <b:column  style="text-align: center;">
                                    <!-- Call the JavaScript function to show the first panel when the page loads -->
                                    <b:commandButton value="Historia Clínica" styleClass="btn btn-default custom-button" type="button" onclick="showPanel('panel1');" />
                                </b:column>
                            </b:row>
                            <b:row>
                                <b:column  style="text-align: center;">
                                    <!-- Call the JavaScript function to show the first panel when the page loads -->
                                    <b:commandButton value="Antecedente" styleClass="btn btn-default custom-button" type="button" onclick="showPanel('panel2');" />
                                </b:column>
                            </b:row>
                            <b:row>
                                <b:column  style="text-align: center;">
                                    <!-- Call the JavaScript function to show the second panel when clicked -->
                                    <b:commandButton value="Signos" styleClass="btn btn-default custom-button" type="button" onclick="showPanel('panel3');" />
                                </b:column>
                            </b:row>
                            <b:row>
                                <b:column  style="text-align: center;">
                                    <!-- Call the JavaScript function to show the second panel when clicked -->
                                    <b:commandButton value="Revisión de órganos y sistemas" styleClass="btn btn-default custom-button" type="button" onclick="showPanel('panel4');" />
                                </b:column>
                            </b:row>
                            <b:row>
                                <b:column  style="text-align: center;">
                                    <!-- Call the JavaScript function to show the second panel when clicked -->
                                    <b:commandButton value="Exámen fisico" styleClass="btn btn-default custom-button" type="button" onclick="showPanel('panel5');" />
                                </b:column>
                            </b:row>
                            <b:row>
                                <b:column  style="text-align: center;">
                                    <!-- Call the JavaScript function to show the second panel when clicked -->
                                    <b:commandButton value="Exámenes" styleClass="btn btn-default custom-button" type="button" onclick="showPanel('panel6');" />
                                </b:column>
                            </b:row>
                            <b:row>
                                <b:column  style="text-align: center;">
                                    <!-- Call the JavaScript function to show the second panel when clicked -->
                                    <b:commandButton value="Diagnóstico " styleClass="btn btn-default custom-button" type="button" onclick="showPanel('panel7');" />
                                </b:column>
                            </b:row>
                            <b:row>
                                <b:column  style="text-align: center;">
                                    <!-- Call the JavaScript function to show the second panel when clicked -->
                                    <b:commandButton value="Tratamiento " styleClass="btn btn-default custom-button" type="button" onclick="showPanel('panel8');" />
                                </b:column>
                            </b:row>
                        </b:column>
                    </b:form>

                    <b:column span="10">
                        <!-- Your left-aligned content goes here -->
                        <b:panelGrid columns="1" id="panel6">
                            <b:panel span="12" offset="0">
                                <h3>
                                    <b>Historia Clínica</b>
                                </h3>
                                <b:panel title="Historia clínica" look="info" collapsible="false">
                                    <b:row>
                                        <b:column span="5">
                                            <b:inputTextarea label="Motivo de la consulta"
                                                         placeholder="Motivo consulta"
                                                         id="motivo_consulta"
                                                         size="13"
                                                         rows="5"
                                                         maxlength="100"
                                                         value="#{CitaBean.historia.hisMotivo}"
                                                         required="true"
                                                         requiredMessage="Describa el motivo de consulta"/>
                                        </b:column>     
                                        <b:column span="7">
                                            <b:inputTextarea label="Enfermedad actual"
                                                        placeholder="Describa la enfermedad"
                                                        id="nomEnfermedadActual"
                                                        size="13"
                                                        rows="5"
                                                        maxlength="3000"
                                                        value="#{CitaBean.historia.hisEnfermedad}"
                                                        required="true"
                                                        requiredMessage="Describa la enfermedad actual"/>
                                        </b:column>
                                    </b:row>

                                </b:panel>
                            </b:panel>
                        </b:panelGrid>
                        <b:panelGrid columns="1" id="panel2">
                            <b:panel span="12" offset="0">
                                <b:form id="formAntecedente">
                                    <h3 id="reply-title">
                                        <b>Antecedentes</b>
                                    </h3>
                                    <b:panel title="Listado de antecedentes" look="info" collapsible="false" id="listadoAntecedente">
                                        <b:tabView style-class="width: 100%">
                                            <b:tab title="Personal">
                                                <ui:include src="citaMedica/tabContentAntecedente.xhtml">
                                                    <ui:param name="lista" value="#{CitaBean.listaAntecedentePer}" />
                                                </ui:include>
                                            </b:tab>
                                            <b:tab title="Familiar">
                                                <ui:include src="citaMedica/tabContentAntecedente.xhtml">
                                                    <ui:param name="lista" value="#{CitaBean.listaAntecedenteFan}" />
                                                </ui:include>
                                            </b:tab>
                                            <b:tab title="Gineco/Obstétrico">
                                                <ui:include src="citaMedica/tabContentAntecedente.xhtml">
                                                    <ui:param name="lista" value="#{CitaBean.listaAntecedenteAnd}" />
                                                </ui:include>
                                            </b:tab>
                                            <b:tab title="Vacunación">
                                                <ui:include src="citaMedica/tabContentAntecedente.xhtml">
                                                    <ui:param name="lista" value="#{CitaBean.listaAntecedenteVac}" />
                                                </ui:include>
                                            </b:tab>
                                        </b:tabView>
                                    </b:panel>
                                    <b:row>
                                        <b:column span="12" class="text-center">
                                            <b:button id="historyAntecedente"
                                                      value="&nbsp;Mostrar Historial "
                                                      onclick="toggleHistorialAntecedentePanel()"
                                                      tooltip="Mostrar Historial" look="info">
                                            </b:button>
                                        </b:column>
                                    </b:row>
                                    <br/>
                                    <b:panel title="Antecedentes del paciente" look="info" collapsible="false" id="panelListaAntecedente">
                                        <b:dataTable large-screen="full-width" id="inscritosTabla" value="#{CitaBean.lista_historia_antecedente}" var="historiaAntecedente" responsive="true" style="font-size: 11px; width: 100%" info="true" content-disabled="false" searching="true"
                                            page-length="7" multi-column-search="true" multi-column-search-position="top" >
                                            <b:dataTableColumn label="Fecha" value="#{CitaBean.fechaFormatoYMDS(historiaAntecedente.hisAntFechaUlt)}" style="width: 5%" />
                                            <b:dataTableColumn label="Tipo" value="#{CitaBean.antecedenteFormato(historiaAntecedente.antecedente.antTipo)}" style="width: 5%" />
                                            <b:dataTableColumn label="Categoría" value="#{historiaAntecedente.antecedente.antCategoria}" style="width: 10%" />
                                            <b:dataTableColumn label="Antecedente" value="#{historiaAntecedente.antecedente.antGrupo}" style="width: 16%" />
                                            <b:dataTableColumn label="Descripción" value="#{historiaAntecedente.hisAntDescripcion}" style="width: 50%" />
                                            <b:dataTableColumn label="Acciones" style="width: 12%; padding-left: 1%;padding-right: 1% "
                                                          orderable="false"
                                                          searchable="false">
                                                <b:column span="1" offset="0">
                                                    <b:commandButton ajax="true" 
                                                                    update="modalUpdateAntecedente :growl"
                                                                    action="#{CitaBean.prepareUpdateHistoriaAntecedente(historiaAntecedente)}"
                                                                    oncomplete="$('#modalUpdateAntecedente').modal('show')" 
                                                                    tooltip="Editar antecedente" 
                                                                    look="warning">
                                                        <b:iconAwesome name="pencil"></b:iconAwesome>
                                                    </b:commandButton>
                                                </b:column>
                                                <b:column offset="1" span="2">
                                                    <b:commandButton ajax="true"
                                                                     update="panelListaAntecedente :growl"
                                                                     tooltip="Eliminar amtecedente"
                                                                     onclick="return confirmarEliminacionAntecedente('#{historiaAntecedente.antecedente.antGrupo}', '#{historiaAntecedente.hisAntDescripcion}');"
                                                                     look="danger">
                                                        <b:iconAwesome name="trash"></b:iconAwesome>
                                                        <f:ajax execute="@this"
                                                                render="formAntecedente:panelListaAntecedente :growl"
                                                                listener="#{CitaBean.eliminarHistoriaAntecedente(historiaAntecedente)}"/>
                                                    </b:commandButton>
                                                </b:column>
                                           </b:dataTableColumn>
                                        </b:dataTable>
                                    </b:panel>
                                    <b:panel title="Historial de antecedentes del paciente" look="info" collapsible="false" id="panelListaHistoriaAntecedente">
                                        <b:dataTable large-screen="full-width" id="listaHistorialAntecedente" value="#{CitaBean.lista_historial_historia_antecedente}" var="historiaAntecedente" responsive="true" style="font-size: 11px; width: 100%" info="true" content-disabled="false" searching="true"
                                            page-length="7" multi-column-search="true" multi-column-search-position="top" >
                                            <b:dataTableColumn label="Fecha" value="#{CitaBean.fechaFormatoYMDS(historiaAntecedente.hisAntFechaUlt)}" style="width: 5%" />
                                            <b:dataTableColumn label="Tipo" value="#{CitaBean.antecedenteFormato(historiaAntecedente.antecedente.antTipo)}" style="width: 5%" />
                                            <b:dataTableColumn label="Categoría" value="#{historiaAntecedente.antecedente.antCategoria}" style="width: 10%" />
                                            <b:dataTableColumn label="Antecedente" value="#{historiaAntecedente.antecedente.antGrupo}" style="width: 15%" />
                                            <b:dataTableColumn label="Descripción" value="#{historiaAntecedente.hisAntDescripcion}" style="width: 50%" />
                                            <b:dataTableColumn label="Doctor" value="#{historiaAntecedente.historias.personasByMedicoPerId.perApellidos} #{historiaAntecedente.historias.personasByMedicoPerId.perNombres}" style="width: 15%" />
                                        </b:dataTable>
                                    </b:panel>
                                </b:form>
                            </b:panel>
                        </b:panelGrid>
                        <b:panelGrid columns="1" id="panel3">
                            <b:panel span="12" offset="0">
                                <ui:include src="citaMedica/panelSignoPaciente.xhtml">
                                </ui:include>
                            </b:panel>
                            <!-- Additional left-aligned content goes here -->
                        </b:panelGrid>
                        <b:panelGrid columns="1" id="panel4">
                            <b:panel span="12" offset="0">  
                                <ui:include src="citaMedica/panelRevision.xhtml">
                                </ui:include>
                            </b:panel>
                        </b:panelGrid>
                        <b:panelGrid columns="1" id="panel5">
                            <b:panel span="12" offset="0">
                                <h3>
                                    <b>Exámen Físico</b>
                                </h3>
                                <b:panel title="Exámen" look="info" collapsible="false">
                                    <b:row>
                                        <b:column span="6">
                                            <b:inputTextarea label="Exámen General"
                                                         placeholder="Examenes generales"
                                                         id="examenes_general"
                                                         size="13"
                                                         rows="5"
                                                         maxlength="2000"
                                                         value="#{CitaBean.historia.hisExamenGeneral}"/>
                                        </b:column>
                                        <b:column span="6">
                                            <b:inputTextarea label="Exámen Neurologico"
                                                         placeholder="Examenes neurologicos"
                                                         id="examenes_neurologicos"
                                                         size="13"
                                                         rows="5"
                                                         maxlength="2000"
                                                         value="#{CitaBean.historia.hisExamenNeurologico}"/>
                                        </b:column>
                                    </b:row>
                                </b:panel>
                            </b:panel>
                        </b:panelGrid>
                        <b:panelGrid columns="1" id="panel1" span="12" offset="0">
                            <h:form id="formExamenLabIma">
                                <h3 id="reply-title">
                                    <b>Exámenes</b>
                                </h3>
                                <b:panel title="Listado de exámenes" look="info" collapsible="false" id="listadoExamenes">
                                    <b:tabView style-class="width: 100%">
                                        <b:tab title="Laboratorio">
                                            <ui:include src="citaMedica/tabContentExamen.xhtml">
                                                <ui:param name="lista" value="#{CitaBean.listaExamenesLab}" />
                                            </ui:include>
                                        </b:tab>
                                        <b:tab title="Imagenología">
                                            <ui:include src="citaMedica/tabContentExamen.xhtml">
                                                <ui:param name="lista" value="#{CitaBean.listaExamenesImg}" />
                                            </ui:include>
                                        </b:tab>
                                        <b:tab title="Histopatología">
                                            <ui:include src="citaMedica/tabContentExamen.xhtml">
                                                <ui:param name="lista" value="#{CitaBean.listaExamenesHist}" />
                                            </ui:include>
                                        </b:tab>
                                    </b:tabView>
                                </b:panel>
                                <b:row>
                                    <b:column span="12" class="text-center">
                                        <b:button id="historyExamen"
                                                  value="&nbsp;Mostrar Historial "
                                                  onclick="toggleHistorialPanel()"
                                                  tooltip="Mostrar Historial" look="info">
                                        </b:button>
                                    </b:column>
                                </b:row>
                                <br/>
                                <b:panel title="Exámenes de laboratorio e imagen" look="info" collapsible="false" id="listadoExamenPaciente" span="12">
                                    <b:dataTable large-screen="full-width" id="examenesTabla" value="#{CitaBean.lista_historia_examen}" var="historiaExamen" responsive="true" style="font-size: 11px; width: 100%" info="true" content-disabled="false" searching="true"
                                       page-length="7" multi-column-search="true" multi-column-search-position="top" >
                                        
                                        <b:dataTableColumn label="Fecha" value="#{CitaBean.fechaFormatoYMDS(historiaExamen.hisExaFechaUlt)}" style="width: 5%" />
                                        <b:dataTableColumn label="Tipo" value="#{CitaBean.antecedenteFormatoExamen(historiaExamen.examenes.exaTipo)}" style="width: 10%" />
                                        <b:dataTableColumn label="Exámen" value="#{historiaExamen.examenes.exaGrupo}" style="width: 15%" />
                                        <b:dataTableColumn label="Fecha Exámen" value="#{CitaBean.fechaFormatoYMDS(historiaExamen.hisExaFecha)}" style="width: 5%" />
                                        <b:dataTableColumn label="Resultado" value="#{historiaExamen.hisExaDescripcion}" style="width: 35%; height: 10%;" />
                                        <b:dataTableColumn label="Doctor" orderable="false" searchable="false" value="#{historiaExamen.historias.personasByMedicoPerId.perApellidos} #{historiaExamen.historias.personasByMedicoPerId.perNombres}" style="width: 15%" />
                                        <b:dataTableColumn label="Acciones" style="width: 10%; padding-left: 1%;padding-right: 1% "
                                                           orderable="false"
                                                           searchable="false">
                                            <b:column offset="1" span="0" rendered="#{historiaExamen.hisExaCompletado eq '0' }">
                                                <b:commandButton ajax="true" 
                                                                 update=":modalActualizarHistoriaExamen :growl"
                                                                 action="#{CitaBean.prepararActualizacionHistoriaExamen(historiaExamen)}"
                                                                 oncomplete="$('#modalActualizarHistoriaExamen').modal('show')" 
                                                                 tooltip="Editar resultado del exámen" look="warning">
                                                   <b:iconAwesome name="pencil"></b:iconAwesome>
                                               </b:commandButton>
                                            </b:column>
                                            <b:column offset="1" span="2">
                                                <b:commandButton ajax="true"
                                                                 update="formExamenLabIma:listadoExamenPaciente :growl"
                                                                 tooltip="Eliminar exámen"
                                                                 onclick="return confirmarEliminacionExamen('#{historiaExamen.examenes.exaGrupo}','#{historiaExamen.hisExaDescripcion}');"                                                                 look="danger">
                                                    <b:iconAwesome name="trash"></b:iconAwesome>
                                                    <f:ajax execute="@this"
                                                            render="formExamenLabIma:listadoExamenPaciente :growl"
                                                            listener="#{CitaBean.eliminarHistoriaExamen(historiaExamen)}"/>
                                                </b:commandButton>
                                            </b:column>
                                        </b:dataTableColumn>
                                    </b:dataTable>
                                </b:panel>
                                <b:panel title="Historial" look="info" collapsible="false" id="historialPanel" span="12" >
                                    <b:dataTable large-screen="full-width" id="examenesHistoriaTabla" value="#{CitaBean.lista_Historial_historia_examen}" var="historiaExamen" responsive="true" style="font-size: 11px; width: 100%" info="true" content-disabled="false" searching="true"
                                       page-length="7" multi-column-search="true" multi-column-search-position="top" >
                                       <b:dataTableColumn label="Fecha" value="#{CitaBean.fechaFormatoYMDS(historiaExamen.hisExaFechaUlt)}" style="width: 5%" />
                                       <b:dataTableColumn label="Tipo" value="#{CitaBean.antecedenteFormatoExamen(historiaExamen.examenes.exaTipo)}" style="width: 10%" />
                                       <b:dataTableColumn label="Exámen" value="#{historiaExamen.examenes.exaGrupo}" style="width: 15%" />
                                       <b:dataTableColumn label="Fecha Exámen" value="#{CitaBean.fechaFormatoYMDS(historiaExamen.hisExaFecha)}" style="width: 5%" />
                                       <b:dataTableColumn label="Resultado" value="#{historiaExamen.hisExaDescripcion}" style="width: 35%" />
                                       <b:dataTableColumn label="Doctor" orderable="false" searchable="false" value="#{historiaExamen.historias.personasByMedicoPerId.perApellidos} #{historiaExamen.historias.personasByMedicoPerId.perNombres}" style="width: 15%" />
                                    </b:dataTable>
                                </b:panel>
                            </h:form>
                        </b:panelGrid>
                        <b:panelGrid columns="1" id="panel7" span="12" offset="0">
                            <h:form id="formDiagnostico">
                                <h3 id="reply-title">
                                    <b>Diagnóstico</b>
                                </h3>
                                <b:panel title="Listado de diagnóstico" look="info" collapsible="false" id="listadoDiagnostico">
                                    <b:row>
                                        <b:column span="12" class="text-center">
                                            <b:commandButton ajax="true"
                                                            value="&nbsp; Nuevo diagnóstico"
                                                            oncomplete="$('#modalAddDiagnostico').modal('show')"
                                                            tooltip="Crear exámenes" look="primary">
                                                <b:iconAwesome name="plus"></b:iconAwesome>
                                            </b:commandButton>
                                        </b:column>
                                    </b:row>
                                    <ui:include src="citaMedica/tabContentDiagnostico.xhtml">
                                        <ui:param name="lista" value="#{CitaBean.lista_diagnosticos_all}" />
                                    </ui:include>
                                </b:panel>
                                <b:row>
                                    <b:column span="12" class="text-center">
                                        <b:button id="historyDiagnostico"
                                                  value="&nbsp;Mostrar Historial "
                                                  onclick="toggleHistorialDiagnosticoPanel()"
                                                  tooltip="Mostrar Historial" look="info">
                                        </b:button>
                                    </b:column>
                                </b:row>
                                <br/>
                                <b:panel title="Diagnóstico" look="info" collapsible="false" id="listadoDiagnosticoPaciente" span="12">
                                    <b:dataTable large-screen="full-width" id="historiaDiagnosticoTabla" value="#{CitaBean.lista_historia_diagnostico}" var="historiaDiagnostico" responsive="true" style="font-size: 11px; width: 100%" info="true" content-disabled="false" searching="true"
                                        page-length="7" multi-column-search="true" multi-column-search-position="top" >
                                        <b:dataTableColumn label="Código" value="#{CitaBean.antecedenteFormatoExamen(historiaDiagnostico.diagnosticos.diaCodigoCie)}" style="width: 5%" />
                                        <b:dataTableColumn label="Descripción" value="#{historiaDiagnostico.diagnosticos.diaDescripcionCie}" style="width: 20%" />
                                        <b:dataTableColumn label="Tipo" value="#{CitaBean.formatoTipoDiagostico(historiaDiagnostico.hisDiaTipo)}" style="width: 8%" />
                                        <b:dataTableColumn label="Condición" value="#{CitaBean.formatoCondicionDiagostico(historiaDiagnostico.hisDiaCondicion)}" style="width: 8%" />
                                        <b:dataTableColumn label="Cronología" value="#{CitaBean.formatoCronologiaDiagostico(historiaDiagnostico.hisDiaCronologia)}" style="width: 8%" />
                                        <b:dataTableColumn label="Observación" value="#{historiaDiagnostico.hisDiaObservacion}" style="width: 37%" />
                                        <b:dataTableColumn label="Acciones" style="width: 12%; padding-left: 1%;padding-right: 1% "
                                                          orderable="false"
                                                          searchable="false">
                                            <b:column span="1" offset="0">
                                                <b:commandButton ajax="true" 
                                                                update="modaUpdateHistoriaDiagnostico :growl"
                                                                action="#{CitaBean.prepareUpdateHistoriaDiagnostico(historiaDiagnostico)}"
                                                                oncomplete="$('#modaUpdateHistoriaDiagnostico').modal('show')" 
                                                                tooltip="Editar diagnóstico" 
                                                                look="warning">
                                                    <b:iconAwesome name="pencil"></b:iconAwesome>
                                                </b:commandButton>
                                            </b:column>
                                            <b:column offset="1" span="2">
                                                <b:commandButton ajax="true"
                                                                 update="formDiagnostico:historiaDiagnosticoTabla :growl"
                                                                 tooltip="Eliminar diagnóstico"
                                                                 onclick="return confirmarEliminacionDiagnostico('#{historiaDiagnostico.diagnosticos.diaDescripcionCie}','#{historiaDiagnostico.hisDiaObservacion}');"                                                                 look="danger">
                                                    <b:iconAwesome name="trash"></b:iconAwesome>
                                                    <f:ajax execute="@this"
                                                            render="formDiagnostico:listadoDiagnosticoPaciente :growl"
                                                            listener="#{CitaBean.eliminarHistoriaDiagnostico(historiaDiagnostico)}"/>
                                                </b:commandButton>
                                            </b:column>
                                       </b:dataTableColumn>
                                    </b:dataTable>
                                </b:panel>
                                <b:panel title="Historial" look="info" collapsible="false" id="historialDiagnosticoPanel" span="12" >
                                    <b:dataTable large-screen="full-width" id="diagnosticoHistoriaTabla" value="#{CitaBean.lista_historial_historia_diagnostico}" var="historiaDiagnostico" responsive="true" style="font-size: 11px; width: 100%" info="true" content-disabled="false" searching="true"
                                       page-length="7" multi-column-search="true" multi-column-search-position="top" >
                                        <b:dataTableColumn label="Fecha" value="#{CitaBean.fechaFormatoYMDS(historiaDiagnostico.hisDiaFechaUlt)}" style="width: 5%" />
                                        <b:dataTableColumn label="Código" value="#{CitaBean.antecedenteFormatoExamen(historiaDiagnostico.diagnosticos.diaCodigoCie)}" style="width: 5%" />
                                        <b:dataTableColumn label="Descripción" value="#{historiaDiagnostico.diagnosticos.diaDescripcionCie}" style="width: 20%" />
                                        <b:dataTableColumn label="Tipo" value="#{CitaBean.formatoTipoDiagostico(historiaDiagnostico.hisDiaTipo)}" style="width: 8%" />
                                        <b:dataTableColumn label="Condición" value="#{CitaBean.formatoCondicionDiagostico(historiaDiagnostico.hisDiaCondicion)}" style="width: 8%" />
                                        <b:dataTableColumn label="Cronología" value="#{CitaBean.formatoCronologiaDiagostico(historiaDiagnostico.hisDiaCronologia)}" style="width: 8%" />
                                        <b:dataTableColumn label="Observación" value="#{historiaDiagnostico.hisDiaObservacion}" style="width: 35%" />
                                        <b:dataTableColumn label="Doctor" orderable="false" searchable="false" value="#{historiaDiagnostico.historias.personasByMedicoPerId.perApellidos} #{historiaDiagnostico.historias.personasByMedicoPerId.perNombres}" style="width: 11%" />
                                    </b:dataTable>
                                </b:panel>
                            </h:form>
                        </b:panelGrid>
                        <b:panelGrid columns="1" id="panel8">
                            <b:form id="formPrescripcion1">
                                <b:panel span="12" offset="0" id="panelTratamiento">  
                                    <ui:include src="citaMedica/panelPrescripcion.xhtml">
                                    </ui:include>
                                </b:panel>
                                <br/>
                            </b:form>
                            <h:form id="formPrescripcion">
                                <b:panel title="Tratamientos" look="info" collapsible="false" id="listadoTratamientoPaciente" span="12">
                                    <b:dataTable large-screen="full-width" id="historiaDiagnosticoTabla" value="#{CitaBean.lista_historia_tratamiento}" var="historiaTratamiento" responsive="true" style="font-size: 11px; width: 100%" info="true" content-disabled="false" searching="true"
                                        page-length="7" multi-column-search="true" multi-column-search-position="top" >
                                        <b:dataTableColumn label="Diagnóstico" value="#{historiaTratamiento.historiaDiagnostico.diagnosticos.diaDescripcionCie}" style="width: 15%" />
                                        <b:dataTableColumn label="Medicamento" value="#{historiaTratamiento.tratamientos.medicamentos.medNombre}" style="width: 15%" />
                                        <b:dataTableColumn label="Vía de administración" value="#{CitaBean.formatoViaAdministracionTratamiento(historiaTratamiento.tratamientos.traViaAdministracion)}" style="width: 15%" />
                                        <b:dataTableColumn label="Dósis unitaria" value="#{historiaTratamiento.tratamientos.medicamentos.medDosisUnitaria}" style="width: 5%" />
                                        <b:dataTableColumn label="Medida" value="#{CitaBean.formatoMedidaMedicamento(historiaTratamiento.tratamientos.medicamentos.medMedida)}" style="width: 10%" />
                                        <b:dataTableColumn label="Frecuencia" value="#{CitaBean.formatoFrecuenciaTratamiento(historiaTratamiento.tratamientos.traFrecuencia)}" style="width: 10%" />
                                        <b:dataTableColumn label="Duración" value="#{historiaTratamiento.tratamientos.traDuracion}" style="width: 5%" />
                                        <b:dataTableColumn label="Acciones" style="width: 12%; padding-left: 1%;padding-right: 1% "
                                                          orderable="false"
                                                          searchable="false">
                                            <b:column span="1" offset="0">
                                                <b:commandButton ajax="true" 
                                                                update="modaUpdateHistoriaTratamiento :growl"
                                                                action="#{CitaBean.prepareUpdateHistoriaTratamiento(historiaTratamiento)}"
                                                                oncomplete="$('#modaUpdateHistoriaTratamiento').modal('show')" 
                                                                tooltip="Editar tratamiento" 
                                                                look="warning">
                                                    <b:iconAwesome name="pencil"></b:iconAwesome>
                                                </b:commandButton>
                                            </b:column>
                                            <b:column offset="1" span="2">
                                                <b:commandButton ajax="true"
                                                                 update="historiaDiagnosticoTabla :growl"
                                                                 tooltip="Eliminar tratamiento"
                                                                 onclick="return confirmarEliminacionTratamiento('#{historiaTratamiento.historiaDiagnostico.diagnosticos.diaDescripcionCie}', '#{historiaTratamiento.tratamientos.medicamentos.medNombre}', '#{historiaTratamiento.tratamientos.traIndicaciones}');"                                                                 look="danger">
                                                    <b:iconAwesome name="trash"></b:iconAwesome>
                                                    <f:ajax execute="@this"
                                                            render="formPrescripcion :growl"
                                                            listener="#{CitaBean.eliminarHistoriaTratamiento(historiaTratamiento)}"/>
                                                </b:commandButton>
                                            </b:column>
                                       </b:dataTableColumn>
                                    </b:dataTable>
                                </b:panel>
                            </h:form>
                        </b:panelGrid>
                    </b:column>
                </b:row>
            </div>
        </b:container>
        <br/><br/><br/><br/>
    </h:body>
    <my:piePagina id="piePagina"/>
</html>